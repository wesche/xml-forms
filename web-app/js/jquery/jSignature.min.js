/*

jSignature v2
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


jSignature v2 jSignature's Undo Button and undo functionality plugin
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


jSignature v2 jSignature's custom "base30" format export and import plugins.
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 SVG export plugin.
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>

*/
(function(j){function q(b){for(var i,s=b.css("color"),h,b=b[0],c=!1;b&&!h&&!c;){try{i=j(b).css("background-color")}catch(d){i="transparent"}"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(h=i);c=b.body;b=b.parentNode}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,a;i=void 0;(i=s.match(b))?a={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=s.match(c))&&(a={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)});var g;
h?(i=void 0,(i=h.match(b))?g={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=h.match(c))&&(g={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)})):g=a?127<Math.max.apply(null,[a.r,a.g,a.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};i=function(b){return"rgb("+[b.r,b.g,b.b].join(", ")+")"};a&&g?(b=Math.max.apply(null,[a.r,a.g,a.b]),a=Math.max.apply(null,[g.r,g.g,g.b]),a=Math.round(a+-0.75*(a-b)),a={r:a,g:a,b:a}):a?(a=Math.max.apply(null,[a.r,a.g,a.b]),b=1,127<
a&&(b=-1),a=Math.round(a+96*b),a={r:a,g:a,b:a}):a={r:191,g:191,b:191};return{color:s,"background-color":g?i(g):h,"decor-color":i(a)}}function f(b,i){this.x=b;this.y=i;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var s=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=
0;else if(0===this.x)this._length=b,this.y=b*s(this.y);else if(0===this.y)this._length=b,this.x=b*s(this.x);else{var i=Math.abs(this.y/this.x),a=Math.sqrt(Math.pow(b,2)/(1+Math.pow(i,2))),i=i*a;this._length=b;this.x=a*s(this.x);this.y=i*s(this.y)}return this};this.angleTo=function(b){var i=this.getLength()*b.getLength();return 0===i?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/i,-1),1))/Math.PI}}function o(b,i){this.x=b;this.y=i;this.getVectorToCoordinates=function(b,i){return new f(b-this.x,
i-this.y)};this.getVectorFromCoordinates=function(b,i){return this.getVectorToCoordinates(b,i).reverse()};this.getVectorToPoint=function(b){return new f(b.x-this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function r(b,i,a,h,c){this.data=b;this.context=i;if(b.length)for(var d=b.length,g,l,e=0;e<d;e++){g=b[e];l=g.x.length;a.call(i,g);for(var k=1;k<l;k++)h.call(i,g,k);c.call(i,g)}this.changed=function(){};this.startStrokeFn=a;this.addToStrokeFn=h;this.endStrokeFn=
c;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(b){if(b&&"number"==typeof b.x&&"number"==typeof b.y){this._stroke={x:[b.x],y:[b.y]};this.data.push(this._stroke);this._lastPoint=b;this.inStroke=!0;var i=this._stroke,a=this.startStrokeFn,h=this.context;setTimeout(function(){a.call(h,i)},3);return b}return null};this.addToStroke=function(b){if(this.inStroke&&"number"===typeof b.x&&"number"===typeof b.y&&4<Math.abs(b.x-this._lastPoint.x)+Math.abs(b.y-this._lastPoint.y)){var i=
this._stroke.x.length;this._stroke.x.push(b.x);this._stroke.y.push(b.y);this._lastPoint=b;var a=this._stroke,h=this.addToStrokeFn,s=this.context;setTimeout(function(){h.call(s,a,i)},3);return b}return null};this.endStroke=function(){var b=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(b){var i=this._stroke,a=this.endStrokeFn,h=this.context,s=this.changed;setTimeout(function(){a.call(h,i);s.call(h)},3);return!0}return null}}function u(b,i,a){var h=this.$parent=j(b),b=this.eventTokens={};this.events=
new w(this);var c=j.fn[e]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};j.extend(d,q(h));i&&j.extend(d,i);this.settings=d;for(var g in a)a.hasOwnProperty(g)&&a[g].call(this,g);this.events.publish(e+".initializing");this.$controlbarUpper=j('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(h);
this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(d);i=j(a);this.$controlbarLower=j('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(h);this.canvasContext=a.getContext("2d");i.data(e+".this",this);h=(h=d.lineWidth)?h:Math.max(Math.round(a.width/400),2);d.lineWidth=h;this.lineCurveThreshold=3*d.lineWidth;d.cssclass&&""!=j.trim(d.cssclass)&&i.addClass(d.cssclass);
this.fatFingerCompensation=0;var h=function(b){var i,a,h=function(h){h=h.changedTouches&&0<h.changedTouches.length?h.changedTouches[0]:h;return new o(Math.round(h.pageX+i),Math.round(h.pageY+a)+b.fatFingerCompensation)},d=new x(750,function(){b.dataEngine.endStroke()});this.drawEndHandler=function(i){try{i.preventDefault()}catch(a){}d.clear();b.dataEngine.endStroke()};this.drawStartHandler=function(c){c.preventDefault();var s=j(b.canvas).offset();i=-1*s.left;a=-1*s.top;b.dataEngine.startStroke(h(c));
d.kick()};this.drawMoveHandler=function(i){i.preventDefault();b.dataEngine.inStroke&&(b.dataEngine.addToStroke(h(i)),d.kick())};return this}.call({},this),l=h.drawEndHandler,k=h.drawStartHandler,f=h.drawMoveHandler,m=this.canvas,i=j(m);this.isCanvasEmulator?(i.bind("mousemove."+e,f),i.bind("mouseup."+e,l),i.bind("mousedown."+e,k)):(m.ontouchstart=function(b){m.onmousedown=void 0;m.onmouseup=void 0;m.onmousemove=void 0;this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?
-3*d.lineWidth:d.minFatFingerCompensation;k(b);m.ontouchend=l;m.ontouchstart=k;m.ontouchmove=f},m.onmousedown=function(b){m.ontouchstart=void 0;m.ontouchend=void 0;m.ontouchmove=void 0;k(b);m.onmousedown=k;m.onmouseup=l;m.onmousemove=f});b[e+".windowmouseup"]=c.subscribe(e+".windowmouseup",h.drawEndHandler);this.events.publish(e+".attachingEventHandlers");var n=this,b=d.width.toString(10),p=e;if("ratio"===b||"%"===b.split("")[b.length-1])this.eventTokens[p+".parentresized"]=c.subscribe(p+".parentresized",
function(b,i,a){return function(){var h=i.width();if(h!==a){for(var d in b)if(b.hasOwnProperty(d)){c.unsubscribe(b[d]);delete b[d]}var s=n.settings;n.$parent.children().remove();for(d in n)n.hasOwnProperty(d)&&delete n[d];d=s.data;var h=h*1/a,g=[],l,k,e,m,f,j;k=0;for(e=d.length;k<e;k++){j=d[k];l={x:[],y:[]};m=0;for(f=j.x.length;m<f;m++){l.x.push(j.x[m]*h);l.y.push(j.y[m]*h)}g.push(l)}s.data=g;i[p](s)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(d.data);
this.events.publish(e+".initialized");return this}var e="jSignature",x=function(b,i){var a;this.kick=function(){clearTimeout(a);a=setTimeout(i,b)};this.clear=function(){clearTimeout(a)};return this},w=function(b){this.topics={};this.context=b?b:this;this.publish=function(b,a,h,d){if(this.topics[b]){var c=this.topics[b],g=Array.prototype.slice.call(arguments,1),l=[],k,e,m,f;e=0;for(m=c.length;e<m;e++)f=c[e],k=f[0],f[1]&&(f[0]=function(){},l.push(e)),k.apply(this.context,g);e=0;for(m=l.length;e<m;e++)c.splice(l[e],
1)}};this.subscribe=function(b,a,h){this.topics[b]?this.topics[b].push([a,h]):this.topics[b]=[[a,h]];return{topic:b,callback:a}};this.unsubscribe=function(b){if(this.topics[b.topic])for(var a=this.topics[b.topic],h=0,d=a.length;h<d;h++)a[h][0]===b.callback&&a.splice(h,1)}},t=function(b){var a=this.canvasContext,d=b.x[0],b=b.y[0],h=this.settings.lineWidth,c=a.fillStyle;a.fillStyle=a.strokeStyle;a.fillRect(d+h/-2,b+h/-2,h,h);a.fillStyle=c},v=function(b,a){var d=new o(b.x[a-1],b.y[a-1]),h=new o(b.x[a],
b.y[a]),c=d.getVectorToPoint(h);if(1<a){var g=new o(b.x[a-2],b.y[a-2]),l=g.getVectorToPoint(d),e;if(l.getLength()>this.lineCurveThreshold){e=2<a?(new o(b.x[a-3],b.y[a-3])).getVectorToPoint(g):new f(0,0);var k=0.35*l.getLength(),m=l.angleTo(e.reverse()),j=c.angleTo(l.reverse());e=(new f(e.x+l.x,e.y+l.y)).resizeTo(Math.max(0.05,m)*k);var n=(new f(l.x+c.x,l.y+c.y)).reverse().resizeTo(Math.max(0.05,j)*k),l=this.canvasContext,k=g.x,j=g.y,m=d.x,p=d.y,y=g.x+e.x,g=g.y+e.y;e=d.x+n.x;n=d.y+n.y;l.beginPath();
l.moveTo(k,j);l.bezierCurveTo(y,g,e,n,m,p);l.stroke()}}c.getLength()<=this.lineCurveThreshold&&(c=this.canvasContext,g=d.x,d=d.y,e=h.x,h=h.y,c.beginPath(),c.moveTo(g,d),c.lineTo(e,h),c.stroke())},m=function(b){var a=b.x.length-1;if(0<a){var d=new o(b.x[a],b.y[a]),h=new o(b.x[a-1],b.y[a-1]),c=h.getVectorToPoint(d);if(c.getLength()>this.lineCurveThreshold){if(1<a){var b=(new o(b.x[a-2],b.y[a-2])).getVectorToPoint(h),g=(new f(b.x+c.x,b.y+c.y)).resizeTo(c.getLength()/2),c=this.canvasContext,b=h.x,a=h.y,
l=d.x,e=d.y,k=h.x+g.x,h=h.y+g.y,g=d.x,d=d.y;c.beginPath();c.moveTo(b,a);c.bezierCurveTo(k,h,g,d,l,e)}else c=this.canvasContext,b=h.x,h=h.y,a=d.x,d=d.y,c.beginPath(),c.moveTo(b,h),c.lineTo(a,d);c.stroke()}}};u.prototype.resetCanvas=function(b){var a=this.canvas,d=this.settings,c=this.canvasContext,g=this.isCanvasEmulator,l=a.width,k=a.height;c.clearRect(0,0,l+30,k+30);c.shadowColor=c.fillStyle=d["background-color"];g&&c.fillRect(0,0,l+30,k+30);c.lineWidth=Math.ceil(parseInt(d.lineWidth,10));c.lineCap=
c.lineJoin="round";c.strokeStyle=d["decor-color"];c.shadowOffsetX=0;c.shadowOffsetY=0;var f=Math.round(k/5),n=1.5*f,p=k-f,l=l-1.5*f,k=k-f;c.beginPath();c.moveTo(n,p);c.lineTo(l,k);c.stroke();c.strokeStyle=d.color;g||(c.shadowColor=c.strokeStyle,c.shadowOffsetX=0.5*c.lineWidth,c.shadowOffsetY=-0.6*c.lineWidth,c.shadowBlur=0);b||(b=[]);c=this.dataEngine=new r(b,this,t,v,m);d.data=b;j(a).data(e+".data",b).data(e+".settings",d);var y=this.$parent,z=this.events,o=e;c.changed=function(){z.publish(o+".change");
y.trigger("change")};c.changed();return!0};u.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=j(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===b.height||!b.height?1:b.height.toString(10)).css("width","ratio"===b.width||!b.width?1:b.width.toString(10));c.appendTo(this.$parent);"ratio"===b.height?c.css("height",Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",
Math.round(c.height()*b.sizeRatio));c.addClass(e);a.width=c.width();a.height=c.height();b=a;if(b.getContext)b=!1;else if("undefined"!==typeof FlashCanvas)b=FlashCanvas.initElement(b),c=1,window&&(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)&&(c=1*window.screen.deviceXDPI/window.screen.logicalXDPI),1!==c&&(j(b).children("object").get(0).resize(Math.ceil(b.width*c),Math.ceil(b.height*c)),b.getContext("2d").scale(c,c)),b=!0;else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
this.isCanvasEmulator=b;a.onselectstart=function(b){b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();return false};return a};var n=function(b,a){var c=new Image,d=this;c.onload=function(){d.getContext("2d").drawImage(c,0,0,c.width<d.width?c.width:d.width,c.height<d.height?c.height:d.height)};c.src="data:"+a+","+b},a=function(b){this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").resetCanvas(b);return this},g=function(b,a){if(void 0===a&&("string"===
typeof b&&"data:"===b.substr(0,5))&&(a=b.slice(5).split(",")[0],b=b.slice(6+a.length),a===b))return;var c=this.find("canvas."+e).add(this.filter("canvas."+e));if(p.hasOwnProperty(a))0!==c.length&&p[a].call(c[0],b,a,function(b){return function(){return b.resetCanvas.apply(b,arguments)}}(c.data(e+".this")));else throw Error(e+" is unable to find import plugin with for format '"+String(a)+"'");return this},d=new w,c=e,l,k=function(){d.publish(c+".parentresized")};j(window).bind("resize."+c,function(){l&&
clearTimeout(l);l=setTimeout(k,500)}).bind("mouseup."+c,function(b){d.publish(c+".windowmouseup",b)});var y={},z={"default":function(){return this.toDataURL()},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},p={"native":function(b,a,c){c(b)},image:n,"image/png;base64":n,"image/jpeg;base64":n,"image/jpg;base64":n},A={"export":z,"import":p,
instance:y},B={init:function(b){return this.each(function(){var a,c=!1;for(a=this.parentNode;a&&!c;)c=a.body,a=a.parentNode;!c||new u(this,b,y)})},getSettings:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").settings},clear:a,reset:a,addPlugin:function(b,a,c){A.hasOwnProperty(b)&&(A[b][a]=c);return this},listPlugins:function(b){var a=[];if(A.hasOwnProperty(b)){var b=A[b],c;for(c in b)b.hasOwnProperty(c)&&a.push(c)}return a},getData:function(b){var a=this.find("canvas."+
e).add(this.filter("canvas."+e));void 0===b&&(b="default");if(0!==a.length&&z.hasOwnProperty(b))return z[b].call(a.get(0),a.data(e+".data"))},importData:g,setData:g,globalEvents:function(){return d},events:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").events}};j.fn[e]=function(b){if(!b||"object"===typeof b)return B.init.apply(this,arguments);if("string"===typeof b&&B[b])return B[b].apply(this,Array.prototype.slice.call(arguments,1));j.error("Method "+String(b)+
" does not exist on jQuery."+e)}})(jQuery);
(function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(j){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[j]){var q=this.settings[j];"function"!==typeof q&&(q=function(){var e=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),f=e.width();e.css("left",Math.round((this.canvas.width-f)/2));f!==e.width()&&e.width(f);return e});var f=q.call(this),
o=this;o.events.subscribe("jSignature.change",function(){o.dataEngine.data.length?f.show():f.hide()});var r=this,u=(this.events.topics.hasOwnProperty("jSignature.undo")?j:"jSignature")+".undo";f.bind("click",function(){r.events.publish(u)});r.events.subscribe(u,function(){var e=r.dataEngine.data;e.length&&(e.pop(),r.resetCanvas(e))})}})})})();
(function(){for(var j={},q={},f="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),o=f.length/2,r=o-1;-1<r;r--)j[f[r]]=f[r+o],q[f[r+o]]=f[r];var u=function(e){for(var e=e.split(""),f=e.length,a=1;a<f;a++)e[a]=j[e[a]];return e.join("")},e=function(e){for(var f=[],a=0,g=1,d=e.length,c,l,k=0;k<d;k++)c=Math.round(e[k]),l=c-a,a=c,0>l&&0<g?(g=-1,f.push("Z")):0<l&&0>g&&(g=1,f.push("Y")),c=Math.abs(l),c>=o?f.push(u(c.toString(o))):f.push(c.toString(o));return f.join("")},x=function(e){for(var f=
[],e=e.split(""),a=e.length,g,d=1,c=[],l=0,k=0;k<a;k++)(g=e[k],g in j||"Z"===g||"Y"===g)?(0!==c.length&&(c=parseInt(c.join(""),o)*d+l,f.push(c),l=c),"Z"===g)?(d=-1,c=[]):"Y"===g?(d=1,c=[]):c=[g]:c.push(q[g]);f.push(parseInt(c.join(""),o)*d+l);return f},w=function(f){for(var j=[],a=f.length,g,d=0;d<a;d++)g=f[d],j.push(e(g.x)),j.push(e(g.y));return j.join("_")},t=function(e){for(var f=[],e=e.split("_"),a=e.length/2,g=0;g<a;g++)f.push({x:x(e[2*g]),y:x(e[2*g+1])});return f},f=function(e){return["image/jsignature;base30",
w(e)]},r=function(e,f,a){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),a(t(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var v=this.jQuery.fn.jSignature;v("addPlugin","export","base30",f);v("addPlugin","export","image/jsignature;base30",f);v("addPlugin","import","base30",r);v("addPlugin","import","image/jsignature;base30",r);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:u,compressstrokeleg:e,uncompressstrokeleg:x,compressstrokes:w,uncompressstrokes:t,charmap:j})}).call("undefined"!==typeof window?window:this);
(function(){function j(a,g){this.x=a;this.y=g;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var d=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*d(this.y);else if(0===this.y)this._length=a,this.x=a*d(this.x);else{var g=Math.abs(this.y/
this.x),e=Math.sqrt(Math.pow(a,2)/(1+Math.pow(g,2))),g=g*e;this._length=a;this.x=e*d(this.x);this.y=g*d(this.y)}return this};this.angleTo=function(a){var d=this.getLength()*a.getLength();return 0===d?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/d,-1),1))/Math.PI}}function q(a,g){this.x=a;this.y=g;this.getVectorToCoordinates=function(a,c){return new j(a-this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new j(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function f(a,g){var d=Math.pow(10,g);return Math.round(a*d)/d}function o(a,g,d){var g=g+1,c=new q(a.x[g-1],a.y[g-1]),e=new q(a.x[g],a.y[g]),e=c.getVectorToPoint(e),k=new q(a.x[g-2],a.y[g-2]),c=k.getVectorToPoint(c);return c.getLength()>d?(d=2<g?(new q(a.x[g-3],a.y[g-3])).getVectorToPoint(k):new j(0,0),a=0.35*c.getLength(),k=c.angleTo(d.reverse()),g=e.angleTo(c.reverse()),d=(new j(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,
k)*a),e=(new j(c.x+e.x,c.y+e.y)).reverse().resizeTo(Math.max(0.05,g)*a),e=new j(c.x+e.x,c.y+e.y),["c",f(d.x,2),f(d.y,2),f(e.x,2),f(e.y,2),f(c.x,2),f(c.y,2)]):["l",f(c.x,2),f(c.y,2)]}function r(a,e){var d=a.x.length-1,c=new q(a.x[d],a.y[d]),l=new q(a.x[d-1],a.y[d-1]),c=l.getVectorToPoint(c);if(1<d&&c.getLength()>e){var d=(new q(a.x[d-2],a.y[d-2])).getVectorToPoint(l),l=c.angleTo(d.reverse()),k=0.35*c.getLength(),d=(new j(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,l)*k);return["c",f(d.x,2),f(d.y,2),f(c.x,
2),f(c.y,2),f(c.x,2),f(c.y,2)]}return["l",f(c.x,2),f(c.y,2)]}function u(a,e,d){for(var e=["M",f(a.x[0]-e,2),f(a.y[0]-d,2)],d=1,c=a.x.length-1;d<c;d++)e.push.apply(e,o(a,d,1));0<c?e.push.apply(e,r(a,d,1)):0===c&&e.push.apply(e,["l",1,1]);return e.join(" ")}function e(a){var e=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],d,c=a.length,l,f=[],j=[],m=l=d=0,p=0,o=[];if(0!==c){for(d=0;d<c;d++){m=
a[d];p=[];l={x:[],y:[]};for(var n=void 0,b=void 0,n=0,b=m.x.length;n<b;n++)p.push({x:m.x[n],y:m.y[n]});p=simplify(p,0.7,!0);n=0;for(b=p.length;n<b;n++)l.x.push(p[n].x),l.y.push(p[n].y);o.push(l);f=f.concat(l.x);j=j.concat(l.y)}a=Math.min.apply(null,f)-1;c=Math.max.apply(null,f)+1;f=Math.min.apply(null,j)-1;j=Math.max.apply(null,j)+1;m=0>a?0:a;p=0>f?0:f;d=c-a;l=j-f}e.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+d.toString()+'" height="'+l.toString()+'">');d=0;for(c=o.length;d<
c;d++)l=o[d],e.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+u(l,m,p)+'"/>');e.push("</svg>");return e.join("")}function x(a){return[m,e(a)]}function w(a){return[n,v(e(a))]}var t=window;"use strict";("undefined"!=typeof exports?exports:t).simplify=function(a,e,d){e=void 0!==e?e*e:1;if(!d){for(var c=a.length,f,k=a[0],j=[k],d=1;d<c;d++){f=a[d];var m=f.x-k.x,p=f.y-k.y;m*m+p*p>e&&(j.push(f),k=f)}a=(k!==f&&j.push(f),j)}f=a;var d=f.length,
c=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(d),k=0,j=d-1,n,o,b=[],i=[],s=[];for(c[k]=c[j]=1;j;){p=0;for(m=k+1;m<j;m++){n=f[m];var h=f[k],r=f[j],q=h.x,u=h.y,h=r.x-q,t=r.y-u,v=void 0;if(0!==h||0!==t)v=((n.x-q)*h+(n.y-u)*t)/(h*h+t*t),1<v?(q=r.x,u=r.y):0<v&&(q+=h*v,u+=t*v);n=(h=n.x-q,t=n.y-u,h*h+t*t);n>p&&(o=m,p=n)}p>e&&(c[o]=1,b.push(k),i.push(o),b.push(o),i.push(j));k=b.pop();j=i.pop()}for(m=0;m<d;m++)c[m]&&s.push(f[m]);return a=s,a};if("function"!==typeof v)var v=function(a){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
d,c,f,k,j=0,m=0,n="",n=[];do d=a.charCodeAt(j++),c=a.charCodeAt(j++),f=a.charCodeAt(j++),k=d<<16|c<<8|f,d=k>>18&63,c=k>>12&63,f=k>>6&63,k&=63,n[m++]=e[d]+e[c]+e[f]+e[k];while(j<a.length);n=n.join("");a=a.length%3;return(a?n.slice(0,a-3):n)+"===".slice(a||3)};var m="image/svg+xml",n="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");t=$.fn.jSignature;t("addPlugin","export","svg",x);t("addPlugin",
"export",m,x);t("addPlugin","export","svgbase64",w);t("addPlugin","export",n,w)})();